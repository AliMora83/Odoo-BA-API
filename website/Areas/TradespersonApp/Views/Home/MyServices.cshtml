
@{
    ViewBag.Title = "MyServices";
    Layout = "~/Areas/TradespersonApp/Views/Shared/_ProviderLayout.cshtml";
}
<script>
    $(document).ready(function () {
        var UserID = localStorage.getItem("P_UserID");
        $.ajax({
            url: '/api/ProviderApi/GetProviderQuotations?providerID=' + UserID,
            type: "get",
            dataType: "JSON",
            beforeSend: function () {
                $("body").mLoading();
            },
            success: function (json) {
                $("body").mLoading('hide');
                if (json.pending.length > 0) {
                    json.pending.forEach(function (item) {
                        let createdate = new Date(item.CreatedDate).toDateString();
                        var ProviderID = item.ProviderID;
                        var CustomerID = item.CustomerID;
                        var IsPaid = item.IsPaid;
                        var FreeLeads = item.FreeLeads;

                        var btn = "<a href='/TradespersonApp/Home/PaymentDetails?qid=" + item.Id + "&cid=" + CustomerID +"' class='btn btn-m btn-full mb-1 rounded-xl text-uppercase font-900 shadow-s bg-ba-theme mt-2'>View Details</a>";

                        if (IsPaid === true) {
                            btn = "<a href='/TradespersonApp/Home/MyServiceDetails?serviceID=" + item.Id + "' " +
                                "class='btn btn-m btn-full mb-1 rounded-xl text-uppercase font-900 shadow-s bg-ba-theme mt-2'>View Details</a>";
                        }
                        else {
                            if (FreeLeads > 0) {
                                btn = "<a href='/TradespersonApp/Home/MyServiceDetails?serviceID=" + item.Id + "&free=1' " +
                                    "class='btn btn-m btn-full mb-1 rounded-xl text-uppercase font-900 shadow-s bg-ba-theme mt-2'>View Details</a>";
                            }
                        }

                        $("#tab-9").append(
                            "<div class='card card-style bg-theme p-2'>" +
                            "<div class='container'>" +
                            "<h5 class='font-500 mb-0'>Customer: <span class='font-400'>" + item.Name + "</span></h5>" +
                            "<div class='product-reviews-summary'><div class='rating-summary'>"+
                            "<strong>Customer Rating: </strong><h4 class='rating-result mb-0' style='line-height: 15px;'><span style='width:" + item.AverageRating + "%'></span></h4></div></div>" +
                            "<h5 class='font-500 font-14'>Urgency: <span class='font-400'>" + item.WorkerUrgency + "</span></h5>" +
                            "<h5 class='font-500 font-14'>Created on: <span class='font-400'>" + createdate + "</span></h5>" +
                            "<h5 class='font-500 font-14'>Service: <span class='font-400'>" + item.ServiceName + "</span></h5>" +
                            btn +
                            "</div>" +
                            "</div>"
                        );
                    });
                } else {
                    $("#tab-9").append(
                        "<div class='card card-style bg-theme pb-3'>" +
                        "<div class='container'>" +
                        "<h5 class='font-500 mt-3'>No records found</h5>" +
                        "</div>" +
                        "</div>"
                    );
                }

                if (json.completed.length > 0) {
                    json.completed.forEach(function (item) {
                        let createdate = new Date(item.CreatedDate).toDateString();
                        var reviewsCount = item.Reviews;
                        var btnReview = "Write a review";
                        if (reviewsCount > 0) {
                            btnReview = "Reviewed";
                        }
                        $("#tab-8").append(
                            "<div class='card card-style bg-theme p-2'>" +
                            "<div class='container'>" +
                            "<h5 class='font-500 mb-0'>Customer: <span class='font-400'>" + item.Name + "</span></h5>" +
                            "<div class='product-reviews-summary'><div class='rating-summary'>" +
                            "<strong>Customer Rating: </strong><h4 class='rating-result mb-0' style='line-height: 15px;'><span style='width:" + item.AverageRating + "%'></span></h4></div></div>" +
                            "<h5 class='font-500 font-14'>Created on: <span class='font-400'>" + createdate + "</span></h5>" +
                            "<h5 class='font-500 font-14'>Service: <span class='font-400'>" + item.ServiceName + "</span></h5>" +
                            "<div class='row mb-0'>" +
                            "<div class='col-6'>" +
                            "<a href='/TradespersonApp/Home/MyServiceDetails?serviceID=" + item.Id + "' " +
                            "class='btn btn-m btn-full mb-1 rounded-xl text-uppercase font-900 shadow-s bg-ba-theme mt-2'>View Details</a>" +
                            "</div>" +
                            "<div class='col-6'>" +
                            "<a href='/TradespersonApp/Home/review?providerID=" + item.ProviderID + "&qid=" + item.Id + "&custid=" + item.CustomerID + "' " +
                            "class='btn btn-m btn-full mb-1 rounded-xl text-uppercase font-900 shadow-s bg-ba-theme mt-2'>" + btnReview + "</a>" +
                            "</div>" +
                            "</div>" +
                            "</div>" +
                            "</div>"
                        );
                    });
                } else {
                    $("#tab-8").append(
                        "<div class='card card-style bg-theme pb-3'>" +
                        "<div class='container'>" +
                        "<h5 class='font-500 mt-3'>No records found</h5>" +
                        "</div>" +
                        "</div>"
                    );
                }

            },
        });
    });    

</script>
<div class="page-content">
    <div class="page-title page-title-small">
        <h2><a href="/TradespersonApp/Home/MyAccount"><i class="fa fa-arrow-left"></i></a>Request List</h2>
    </div>
    <div class="card header-card shape-rounded" data-card-height="150">
        <div class="card-overlay bg-ba-theme opacity-95"></div>
        <div class="card-overlay dark-mode-tint"></div>
        <div class="card-bg"></div>
    </div>

    <div class="card card-style bg-theme pb-0">
        <div class="tab-controls tabs-round tab-animated tabs-medium tabs-rounded shadow-xl" data-tab-items="2" data-tab-active="bg-green1-dark color-white">
            <a href="#" data-tab-active data-tab="tab-9">Pending Requests</a>
            <a href="#" data-tab="tab-8">Completed Requests</a>
        </div>
    </div>
    <div class="clearfix mb-3"></div>
    <div class="tab-content" id="tab-9">

    </div>

    <div class="tab-content" id="tab-8">

    </div>
</div>